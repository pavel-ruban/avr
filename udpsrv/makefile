#############################################################
##############  Make scripts by Pavel Ruban  ################
#############################################################

include makefile.conf

SRC =	main.c

CFILES = $(filter %.c, $(SRC))
SFILES = $(filter %.s, $(SRC))

COBJ = $(CFILES:.c=.o)
SOBJ = $(SFILES:.s=.o)
COBJD = $(COBJ:.o=.d)

all: $(TARGET_BINARY)

# Make c dependencies.
$(COBJD): %.d: %.c
	$(GCC) -MM $< > $@

# Include autogenerated dependencies.
-include $(COBJD)

$(COBJ): %.o: %.c
	$(GCC) $(CFLAGS) $(CINCLUDES) $< -c -o $@

$(SOBJ): %.o: %.s
	$(AS) $(SFLAGS) $(SINCLUDES) $< -c -o $@

# Link binary file
$(TARGET_BINARY): $(COBJD) $(COBJ) $(SOBJ)
	$(GCC) $(SOBJ) $(COBJ) -o $(TARGET_BINARY) $(LINKFLAGS)

.PHONY:	clean

clean:
	@echo "cleaning...."
	-@rm *.{o,d,bin} 2> /dev/null
	@echo "done"
